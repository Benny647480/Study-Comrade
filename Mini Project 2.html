<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>To‑Do List</title>
  <style>
    :root {
      --bg: #0b0f14;
      --card: #111827;
      --muted: #94a3b8;
      --text: #e5e7eb;
      --accent: #60a5fa;
      --accent-2: #34d399;
      --danger: #f87171;
      --shadow: 0 10px 25px rgba(0,0,0,.35);
      --radius: 16px;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 600px at 80% -10%, #1f2937 0%, var(--bg) 55%);
      color: var(--text);
      display: grid;
      place-items: center;
      padding: 24px;
    }
    .app {
      width: 100%;
      max-width: 860px;
      background: linear-gradient(180deg, rgba(255,255,255,.04), transparent), var(--card);
      border: 1px solid rgba(255,255,255,.06);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }
    header {
      padding: 24px clamp(16px, 3vw, 28px) 12px;
      display: grid;
      gap: 12px;
      background: linear-gradient(180deg, rgba(96,165,250,.15), transparent);
    }
    .title {
      display:flex; align-items:center; gap:12px;
    }
    .title h1 { font-size: clamp(20px, 3.2vw, 28px); margin: 0; letter-spacing: .2px; }
    .title .badge { font-size: 12px; color: var(--muted); padding: 4px 10px; border: 1px dashed rgba(148,163,184,.4); border-radius: 999px; }

    .row { display:flex; gap:10px; flex-wrap:wrap; }
    .input {
      flex: 1 1 320px;
      display:flex; gap:10px; align-items:center;
      background: rgba(255,255,255,.04);
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 12px;
      padding: 10px 12px;
    }
    .input input[type="text"] {
      flex:1; background: transparent; border: 0; outline: none; color: var(--text);
      font-size: 15px; padding: 6px 2px;
    }
    .input input[type="date"], .input select {
      background: rgba(255,255,255,.06); border: 1px solid rgba(255,255,255,.12); color: var(--text);
      border-radius: 8px; padding: 6px 8px; font-size: 13px;
    }
    .btn {
      appearance: none; border: 0; cursor: pointer; border-radius: 12px; padding: 10px 14px;
      font-weight: 600; color: #0b1020; background: var(--accent);
      transition: transform .04s ease, filter .2s ease; box-shadow: 0 6px 18px rgba(96,165,250,.35);
    }
    .btn:active { transform: translateY(1px); }
    .btn.secondary { background: rgba(148,163,184,.15); color: var(--text); box-shadow: none; border: 1px solid rgba(255,255,255,.08); }
    .btn.danger { background: var(--danger); color: #1f2937; box-shadow: 0 6px 18px rgba(248,113,113,.35); }

    .toolbar { padding: 8px clamp(16px, 3vw, 28px) 16px; display:flex; gap:10px; align-items:center; flex-wrap: wrap; }
    .filters { display:flex; gap:6px; }
    .chip { padding: 6px 10px; border-radius: 999px; border:1px solid rgba(255,255,255,.1); color: var(--muted); cursor:pointer; user-select:none; font-size: 13px; }
    .chip.active { color: var(--text); background: rgba(96,165,250,.15); border-color: rgba(96,165,250,.35); }
    .spacer { flex: 1 1 auto; }
    .count { color: var(--muted); font-size: 13px; }

    ul { list-style: none; margin: 0; padding: 0; }
    .list { padding: 4px clamp(16px, 3vw, 28px) 18px; display:grid; gap: 10px; }

    .task {
      display:grid; grid-template-columns: 26px 1fr auto; gap: 12px; align-items:center;
      background: rgba(255,255,255,.03); border: 1px solid rgba(255,255,255,.08);
      padding: 12px; border-radius: 14px; transition: background .2s ease, border-color .2s ease;
    }
    .task[draggable="true"] { cursor: grab; }
    .task.dragging { opacity: .6; }
    .task:hover { background: rgba(255,255,255,.05); border-color: rgba(255,255,255,.14); }

    .checkbox { width: 18px; height: 18px; border-radius: 6px; border: 2px solid rgba(148,163,184,.5); display:grid; place-items:center; }
    .checkbox input { appearance:none; width:14px; height:14px; border-radius:4px; background: transparent; display:block; }
    .checkbox input:checked { background: var(--accent-2); }

    .content { display:flex; gap:10px; align-items:center; }
    .text { font-size: 15px; }
    .text.done { text-decoration: line-through; color: var(--muted); }
    .meta { display:flex; gap:8px; align-items:center; color: var(--muted); font-size: 12px; }
    .pill { border: 1px solid rgba(255,255,255,.14); padding: 3px 8px; border-radius: 999px; }
    .pill.low { border-color: rgba(52,211,153,.35); }
    .pill.med { border-color: rgba(96,165,250,.35); }
    .pill.high { border-color: rgba(248,113,113,.35); }

    .actions { display:flex; gap:6px; }
    .iconbtn { background: transparent; border: 1px solid rgba(255,255,255,.12); color: var(--text); border-radius: 10px; padding: 6px 8px; cursor: pointer; }

    .empty { text-align:center; color: var(--muted); padding: 32px 12px 48px; }
    footer { padding: 12px clamp(16px, 3vw, 28px) 22px; display:flex; justify-content: space-between; align-items:center; color: var(--muted); font-size: 12px; border-top: 1px solid rgba(255,255,255,.06); }
    a { color: var(--accent); text-decoration: none; }
    a:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <div class="app" id="app">
    <header>
      <div class="title">
        <h1>To‑Do</h1>
        <span class="badge" id="progressBadge">0/0 done</span>
      </div>
      <div class="row">
        <div class="input" role="group" aria-label="Add new task">
          <input id="taskInput" type="text" placeholder="Add a task… (press Enter)" />
          <input id="dueInput" type="date" />
          <select id="priorityInput" aria-label="Priority">
            <option value="low">Low</option>
            <option value="medium" selected>Medium</option>
            <option value="high">High</option>
          </select>
          <button class="btn" id="addBtn" title="Add">Add</button>
        </div>
      </div>
    </header>

    <div class="toolbar">
      <div class="filters" role="tablist" aria-label="Filters">
        <div class="chip active" data-filter="all" role="tab" tabindex="0">All</div>
        <div class="chip" data-filter="active" role="tab" tabindex="0">Active</div>
        <div class="chip" data-filter="completed" role="tab" tabindex="0">Completed</div>
        <div class="chip" data-filter="today" role="tab" tabindex="0">Due Today</div>
        <div class="chip" data-filter="overdue" role="tab" tabindex="0">Overdue</div>
      </div>
      <div class="spacer"></div>
      <button class="btn secondary" id="exportBtn" title="Export tasks as JSON">Export</button>
      <button class="btn danger" id="clearCompletedBtn" title="Clear completed tasks">Clear Completed</button>
    </div>

    <ul class="list" id="list" aria-live="polite"></ul>
    <div class="empty" id="emptyState">No tasks yet — add your first one above ✨</div>

    <footer>
      <div>Drag tasks to reorder • Stores locally</div>
      <div><a href="#" id="importLink">Import</a></div>
    </footer>
  </div>

  <input type="file" id="fileInput" accept="application/json" hidden />

  <script>
    const STORAGE_KEY = 'todo.tasks.v1';
    let tasks = load();
    let filter = 'all';

    function save() { localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks)); }
    function load() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        return raw ? JSON.parse(raw) : [];
      } catch { return []; }
    }

    const $ = sel => document.querySelector(sel);
    const listEl = $('#list');
    const emptyEl = $('#emptyState');
    const inputEl = $('#taskInput');
    const dueEl = $('#dueInput');
    const priEl = $('#priorityInput');
    const badgeEl = $('#progressBadge');

    function uid() { return Math.random().toString(36).slice(2, 10); }
    function fmtDate(iso) {
      if (!iso) return '';
      const d = new Date(iso + 'T00:00:00');
      return d.toLocaleDateString(undefined, { month:'short', day:'numeric' });
    }
    function isToday(iso) {
      if (!iso) return false;
      const d = new Date(iso);
      const now = new Date();
      return d.getFullYear() === now.getFullYear() && d.getMonth() === now.getMonth() && d.getDate() === now.getDate();
    }
    function isOverdue(iso) {
      if (!iso) return false;
      const today = new Date(); today.setHours(0,0,0,0);
      const d = new Date(iso); d.setHours(0,0,0,0);
      return d < today;
    }

    function addTask(text, due, priority) {
      text = (text || '').trim();
      if (!text) return;
      tasks.push({ id: uid(), text, completed: false, createdAt: Date.now(), due: due || undefined, priority: priority || 'medium' });
      save();
      render();
      inputEl.value = '';
    }

    function updateTask(id, patch) {
      const i = tasks.findIndex(t => t.id === id);
      if (i !== -1) { tasks[i] = { ...tasks[i], ...patch }; save(); render(); }
    }

    function removeTask(id) {
      tasks = tasks.filter(t => t.id !== id); save(); render();
    }

    function clearCompleted() {
      tasks = tasks.filter(t => !t.completed); save(); render();
    }

    function exportTasks() {
      const blob = new Blob([JSON.stringify(tasks, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'tasks.json'; a.click();
      URL.revokeObjectURL(url);
    }

    function importTasks(file) {
      const reader = new FileReader();
      reader.onload = e => {
        try {
          const data = JSON.parse(String(e.target.result));
          if (Array.isArray(data)) { tasks = data; save(); render(); }
          else alert('Invalid file format');
        } catch (err) { alert('Failed to import: ' + err.message); }
      };
      reader.readAsText(file);
    }

    function render() {
      const total = tasks.length;
      const done = tasks.filter(t => t.completed).length;
      badgeEl.textContent = `${done}/${total} done`;

      const filtered = tasks.filter(t => {
        if (filter === 'active') return !t.completed;
        if (filter === 'completed') return t.completed;
        if (filter === 'today') return isToday(t.due);
        if (filter === 'overdue') return !t.completed && isOverdue(t.due);
        return true;
      });

      listEl.innerHTML = '';
      emptyEl.style.display = filtered.length ? 'none' : 'block';

      filtered.forEach(task => listEl.appendChild(taskItem(task)));
      enableDragAndDrop();
    }

    function taskItem(task) {
      const li = document.createElement('li');
      li.className = 'task';
      li.draggable = true;
      li.dataset.id = task.id;
      li.innerHTML = `
        <label class="checkbox" aria-label="Complete">
          <input type="checkbox" ${task.completed ? 'checked' : ''} />
        </label>
        <div class="content">
          <span class="text ${task.completed ? 'done' : ''}" contenteditable="true" spellcheck="false"></span>
          <div class="meta">
            ${task.due ? `<span class="pill ${isOverdue(task.due) && !task.completed ? 'high' : ''}">Due ${fmtDate(task.due)}</span>` : ''}
            <span class="pill ${task.priority === 'low' ? 'low' : task.priority === 'high' ? 'high' : 'med'}">${task.priority}</span>
          </div>
        </div>
        <div class="actions">
          <button class="iconbtn" data-act="edit">Edit</button>
          <button class="iconbtn" data-act="date">Date</button>
          <button class="iconbtn" data-act="priority">Priority</button>
          <button class="iconbtn" data-act="delete">Delete</button>
        </div>`;

      const cb = li.querySelector('input[type="checkbox"]');
      const txt = li.querySelector('.text');
      txt.textContent = task.text;

      cb.addEventListener('change', () => updateTask(task.id, { completed: cb.checked }));

      txt.addEventListener('blur', () => updateTask(task.id, { text: txt.textContent.trim() }));
      txt.addEventListener('keydown', e => { if (e.key === 'Enter') { e.preventDefault(); txt.blur(); } });

      li.querySelector('[data-act="delete"]').addEventListener('click', () => removeTask(task.id));
      li.querySelector('[data-act="edit"]').addEventListener('click', () => { txt.focus(); document.execCommand('selectAll', false, null); });
      li.querySelector('[data-act="date"]').addEventListener('click', async () => {
        const next = prompt('Set due date (YYYY-MM-DD) or leave blank to clear:', task.due || '');
        if (next !== null) updateTask(task.id, { due: next || undefined });
      });
      li.querySelector('[data-act="priority"]').addEventListener('click', () => {
        const cycle = { low: 'medium', medium: 'high', high: 'low' };
        updateTask(task.id, { priority: cycle[task.priority] });
      });

      return li;
    }

    function enableDragAndDrop() {
      const items = [...document.querySelectorAll('.task')];
      items.forEach(el => {
        el.addEventListener('dragstart', () => el.classList.add('dragging'));
        el.addEventListener('dragend', () => el.classList.remove('dragging'));
      });
      listEl.addEventListener('dragover', e => {
        e.preventDefault();
        const after = getDragAfterElement(listEl, e.clientY);
        const dragging = document.querySelector('.dragging');
        if (!dragging) return;
        if (after == null) listEl.appendChild(dragging); else listEl.insertBefore(dragging, after);
      });
      listEl.addEventListener('drop', () => {
        const idsInView = [...listEl.querySelectorAll('.task')].map(el => el.dataset.id);
        const map = new Map(tasks.map(t => [t.id, t]));
        const others = tasks.filter(t => !idsInView.includes(t.id));
        tasks = [...idsInView.map(id => map.get(id)), ...others];
        save();
      });
    }
    function getDragAfterElement(container, y) {
      const els = [...container.querySelectorAll('.task:not(.dragging)')];
      return els.reduce((closest, child) => {
        const box = child.getBoundingClientRect();
        const offset = y - box.top - box.height / 2;
        if (offset < 0 && offset > closest.offset) { return { offset, element: child }; }
        else { return closest; }
      }, { offset: Number.NEGATIVE_INFINITY }).element;
    }

    $('#addBtn').addEventListener('click', () => addTask(inputEl.value, dueEl.value, priEl.value));
    inputEl.addEventListener('keydown', e => { if (e.key === 'Enter') addTask(inputEl.value, dueEl.value, priEl.value); });
    $('#clearCompletedBtn').addEventListener('click', clearCompleted);
    $('#exportBtn').addEventListener('click', exportTasks);

    document.querySelectorAll('.chip').forEach(chip => {
      chip.addEventListener('click', () => { selectFilter(chip.dataset.filter); });
      chip.addEventListener('keydown', e => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); selectFilter(chip.dataset.filter); } });
    });

    function selectFilter(name) {
      filter = name; document.querySelectorAll('.chip').forEach(c => c.classList.toggle('active', c.dataset.filter === name)); render();
    }

    $('#importLink').addEventListener('click', e => { e.preventDefault(); $('#fileInput').click(); });
    $('#fileInput').addEventListener('change', e => { const f = e.target.files?.[0]; if (f) importTasks(f); e.target.value = ''; });

    render();
  </script>
</body>
</html>